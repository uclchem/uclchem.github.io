"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3119],{3905:(a,e,t)=>{t.d(e,{Zo:()=>o,kt:()=>N});var s=t(7294);function n(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function m(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.push.apply(t,s)}return t}function p(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?m(Object(t),!0).forEach((function(e){n(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function r(a,e){if(null==a)return{};var t,s,n=function(a,e){if(null==a)return{};var t,s,n={},m=Object.keys(a);for(s=0;s<m.length;s++)t=m[s],e.indexOf(t)>=0||(n[t]=a[t]);return n}(a,e);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(a);for(s=0;s<m.length;s++)t=m[s],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(a,t)&&(n[t]=a[t])}return n}var l=s.createContext({}),i=function(a){var e=s.useContext(l),t=e;return a&&(t="function"==typeof a?a(e):p(p({},e),a)),t},o=function(a){var e=i(a.components);return s.createElement(l.Provider,{value:e},a.children)},c={inlineCode:"code",wrapper:function(a){var e=a.children;return s.createElement(s.Fragment,{},e)}},h=s.forwardRef((function(a,e){var t=a.components,n=a.mdxType,m=a.originalType,l=a.parentName,o=r(a,["components","mdxType","originalType","parentName"]),h=i(t),N=n,k=h["".concat(l,".").concat(N)]||h[N]||c[N]||m;return t?s.createElement(k,p(p({ref:e},o),{},{components:t})):s.createElement(k,p({ref:e},o))}));function N(a,e){var t=arguments,n=e&&e.mdxType;if("string"==typeof a||n){var m=t.length,p=new Array(m);p[0]=h;var r={};for(var l in e)hasOwnProperty.call(e,l)&&(r[l]=e[l]);r.originalType=a,r.mdxType="string"==typeof a?a:n,p[1]=r;for(var i=2;i<m;i++)p[i]=t[i];return s.createElement.apply(null,p)}return s.createElement.apply(null,t)}h.displayName="MDXCreateElement"},3542:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>N,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var s=t(7462),n=t(3366),m=(t(7294),t(3905)),p=["components"],r={},l="Advanced Physical Modelling",i={unversionedId:"modelling_objects",id:"modelling_objects",title:"Advanced Physical Modelling",description:"In the previous tutorial, we simply modelled the chemistry of a static cloud for 1 Myr. This is unlikely to meet everybody's modelling needs and UCLCHEM is capable of modelling much more complex environments such as hot cores and shocks. In this tutorial, we model both a hot core and a shock to explore how these models work and to demonstrate the workflow that the UCLCHEM team normally follow.",source:"@site/docs/modelling_objects.md",sourceDirName:".",slug:"/modelling_objects",permalink:"/docs/modelling_objects",tags:[],version:"current",lastUpdatedBy:"jonholdship",lastUpdatedAt:1651073142,formattedLastUpdatedAt:"4/27/2022",frontMatter:{},sidebar:"docs",previous:{title:"Running Your First Models",permalink:"/docs/first_model"},next:{title:"Running a Grid",permalink:"/docs/running_a_grid"}},o={},c=[{value:"The Hot Core",id:"the-hot-core",level:2},{value:"Initial Conditions",id:"initial-conditions",level:3},{value:"Running the Science Model",id:"running-the-science-model",level:3},{value:"Checking the Result",id:"checking-the-result",level:3},{value:"Shocks",id:"shocks",level:2},{value:"C-shock",id:"c-shock",level:3},{value:"J-shock",id:"j-shock",level:3}],h={toc:c};function N(a){var e=a.components,r=(0,n.Z)(a,p);return(0,m.kt)("wrapper",(0,s.Z)({},h,r,{components:e,mdxType:"MDXLayout"}),(0,m.kt)("h1",{id:"advanced-physical-modelling"},"Advanced Physical Modelling"),(0,m.kt)("p",null,"In the previous tutorial, we simply modelled the chemistry of a static cloud for 1 Myr. This is unlikely to meet everybody's modelling needs and UCLCHEM is capable of modelling much more complex environments such as hot cores and shocks. In this tutorial, we model both a hot core and a shock to explore how these models work and to demonstrate the workflow that the UCLCHEM team normally follow."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},"import uclchem\nimport matplotlib.pyplot as plt\n")),(0,m.kt)("h2",{id:"the-hot-core"},"The Hot Core"),(0,m.kt)("h3",{id:"initial-conditions"},"Initial Conditions"),(0,m.kt)("p",null,"UCLCHEM typically starts with the gas in atomic/ionic form with no molecules. However, this clearly is not appropriate when modelling an object such as a hot core. In these objects, the gas is already evolved and there should be molecules in the gas phase as well as ice mantles on the dust. To allow for this, one must provide some initial abundances to the model. There are many ways to do this but we typically chose to run a preliminary model to produce our abundances."),(0,m.kt)("p",null,"For this case, we will use ",(0,m.kt)("inlineCode",{parentName:"p"},"uclchem.model.cloud()")," to run a model where a cloud of gas collapses from a density of ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mn",{parentName:"msup"},"2")),(0,m.kt)("mi",{parentName:"mrow"},"c"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mi",{parentName:"msup"},"m"),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"3")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"10^2 cm^{-3}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"2")))))))),(0,m.kt)("span",{parentName:"span",className:"mord mathnormal"},"c"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"3")))))))))))))," to our hot core density of ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mn",{parentName:"msup"},"6")),(0,m.kt)("mi",{parentName:"mrow"},"c"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mi",{parentName:"msup"},"m"),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"3")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"10^6 cm^{-3}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"6")))))))),(0,m.kt)("span",{parentName:"span",className:"mord mathnormal"},"c"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"3"))))))))))))),". During this collapse, chemistry will occur and we can assume the final abundances of this model will be reasonable starting abundances for the hot core. "),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'# set a parameter dictionary for cloud collapse model\nparam_dict = {\n    "endAtFinalDensity": False,#stop at finalTime\n    "freefall": True,#increase density in freefall\n    "initialDens": 1e2, #starting density\n    "finalDens":1e6, #final density\n    "initialTemp": 10.0,#temperature of gas\n    "finalTime": 6.0e6, #final time\n    "rout":0.1, #radius of cloud in pc\n    "baseAv":1.0, #visual extinction at cloud edge.\n    "abundSaveFile": "../examples/test-output/startcollapse.dat",#save final abundances to file\n    "outputFile":"../examples/test-output/phase1-full.dat"\n\n}\nresult = uclchem.model.cloud(param_dict=param_dict)\n\n')),(0,m.kt)("p",null,"With that done, we now have a file containing the final abundances of a cloud of gas after this collapse: ",(0,m.kt)("inlineCode",{parentName:"p"},'param_dict["abundSaveFile"]')," we can pass this to our hot core model to use those abundances as our initial abundances."),(0,m.kt)("h3",{id:"running-the-science-model"},"Running the Science Model"),(0,m.kt)("p",null,"We need to change just a few things in ",(0,m.kt)("inlineCode",{parentName:"p"},"param_dict")," to set up the hot core model. The key one is that UCLCHEM saves final abundances to ",(0,m.kt)("inlineCode",{parentName:"p"},"abundSaveFile")," but loads them from ",(0,m.kt)("inlineCode",{parentName:"p"},"abundLoadFile")," so we need to swap that key over to make the abundances we just produced our initial abundances. "),(0,m.kt)("p",null,"We also want to turn off freefall and change how long the model runs for."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'#change other bits of input to set up phase 2\nparam_dict["initialDens"]=1e6\nparam_dict["finalTime"]=1e6\nparam_dict["freefall"]=False\n\n#phase 2 never cools so freeze out should be negligible\n#can really speed integrator by just turning it off\nparam_dict["freezeFactor"]=0 \nparam_dict["abstol_factor"]=1e-18\nparam_dict["reltol"]=1e-12\nparam_dict["abundLoadFile"]=param_dict.pop("abundSaveFile") #this is still set to startcollapse.dat from phase 1 so remove it or change it.\nparam_dict["outputFile"]="../examples/test-output/phase2-full.dat"\n\nresult=uclchem.model.hot_core(temp_indx=3,max_temperature=300.0,param_dict=param_dict)\n')),(0,m.kt)("p",null,"Note that we've changed abstol and reltol here. They control the integrator accuracy and whilst making them smaller does slow down successful runs, it can make runs complete that stall completely otherwise. In this case, we found that when we didn't alter the defaults, the model completed but ",(0,m.kt)("inlineCode",{parentName:"p"},"uclchem.check_element_conservation()")," showed C and O were not conserved. By reducing these tolerances, we were fix this as shown below."),(0,m.kt)("p",null,"If your model run does not complete, try running it in a python script rather the notebook. In notebooks, the fortran output is only printed when the function returns which may be never on a stalled run. In python scripts, the output is printed as the code is executed and you will see warnings if the integrator gets stuck."),(0,m.kt)("h3",{id:"checking-the-result"},"Checking the Result"),(0,m.kt)("p",null,"With a successful run, we can check the output. We first load the file and check the abundance conservation, then we can plot it up."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'phase2_df=uclchem.analysis.read_output_file("../examples/test-output/phase2-full.dat")\nuclchem.analysis.check_element_conservation(phase2_df)\n')),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre"},"{'H': '0.002%', 'N': '0.000%', 'C': '0.000%', 'O': '0.000%'}\n")),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'species=["CO","H2O","CH3OH","#CO","#H2O","#CH3OH","@H2O","@CO","@CH3OH"]\n\nfig,[ax,ax2]=plt.subplots(1,2,figsize=(16,9))\nax=uclchem.analysis.plot_species(ax,phase2_df,species)\nsettings=ax.set(yscale="log",xlim=(1e2,1e6),ylim=(1e-10,1e-2),\n            xlabel="Time / years", \n            ylabel="Fractional Abundance",xscale="log")\n\nax2.plot(phase2_df["Time"],phase2_df["Density"],color="black")\nax2.set(xscale="log")\nax3=ax2.twinx()\nax3.plot(phase2_df["Time"],phase2_df["gasTemp"],color="red")\nax2.set(xlabel="Time / year",ylabel="Density")\nax3.set(ylabel="Temperature",facecolor="red",xlim=(1e2,1e6))\nax3.tick_params(axis=\'y\', colors=\'red\')\n')),(0,m.kt)("p",null,(0,m.kt)("img",{alt:"png",src:t(3944).Z,width:"997",height:"549"})),(0,m.kt)("p",null,"Here, we see the value of running a collapse phase before the science run. Having run a collapse, we start this model with well developed ices and having material in the surface and bulk allows us to properly model the effect of warm up in a hot core. For example, the @CO abundance is ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mo",{parentName:"mrow"},"\u223c"),(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"4")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\sim10^{-4}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.36687em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mrel"},"\u223c"),(0,m.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"4")))))))))))))," and #CO is ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mo",{parentName:"mrow"},"\u223c"),(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"6")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\sim10^{-6}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.36687em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mrel"},"\u223c"),(0,m.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"6"))))))))))))),". As the gas warms to around 30K, the #CO abundance drops drastically as CO's binding energy is such that it is efficiently desorbed from the surface at this temperature. However, the rest of the CO is trapped in the bulk, surrounded by more strongly bound H2O molecules. Thus, the @CO abundance stays high until the gas reaches around 130K, when the H2O molecules are released along with the entire bulk."),(0,m.kt)("h2",{id:"shocks"},"Shocks"),(0,m.kt)("p",null,"Essentially the same process should be followed for shocks. Let's run a C-type and J-type shock through a gas of density ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mn",{parentName:"msup"},"4")),(0,m.kt)("mi",{parentName:"mrow"},"c"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mi",{parentName:"msup"},"m"),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"3")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"10^4 cm^{-3}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"4")))))))),(0,m.kt)("span",{parentName:"span",className:"mord mathnormal"},"c"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord mathnormal"},"m"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"3"))))))))))))),". Again, we first run a simple cloud model to obtain some reasonable starting abundances, then we can run the shocks."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'# set a parameter dictionary for phase 1 collapse model\n\nparam_dict = {\n    "endAtFinalDensity": False,#stop at finalTime\n    "freefall": True,#increase density in freefall\n    "initialDens": 1e2, #starting density\n    "finalDens":1e4, #final density\n    "initialTemp": 10.0,#temperature of gas\n    "finalTime": 6.0e6, #final time\n    "rout":0.1, #radius of cloud in pc\n    "baseAv":1.0, #visual extinction at cloud edge.\n    "abundSaveFile": "../examples/test-output/shockstart.dat",\n}\nresult = uclchem.model.cloud(param_dict=param_dict)\n')),(0,m.kt)("h3",{id:"c-shock"},"C-shock"),(0,m.kt)("p",null,"We'll first run a c-shock. We'll run a 40 km s ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mrow",{parentName:"msup"}),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"1")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"^{-1}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span"}),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"1")))))))))))))," shock through a gas of density ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mn",{parentName:"msup"},"4"))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"10^4")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"4"))))))))))))," cm ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mrow",{parentName:"msup"}),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"3")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"^{-3}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span"}),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"3"))))))))))))),", using the abundances we just produced."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'#change other bits of input to set up phase 2\nparam_dict["initialDens"]=1e4\nparam_dict["finalTime"]=1e6\nif "abundSaveFile" in param_dict:\n    param_dict.pop("abundSaveFile")\nparam_dict["abundLoadFile"]="../examples/test-output/shockstart.dat"\nparam_dict["outputFile"]="../examples/test-output/cshock.dat"\n\n\nresult=uclchem.model.cshock(shock_vel=40,param_dict=param_dict)\nresult,dissipation_time=result\n')),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre"}," Cannot have freefall on during cshock\n setting freefall=0 and continuing\n At current T(=R1), MXSTEP(=I1) steps                                            \n taken on this call before reaching TOUT.                                        \nIn the above message, I1 =      10000\nIn the above message, R1 =   0.1931420520843D+12\n ISTATE -1: Reducing time step\n")),(0,m.kt)("p",null,"The code completes fine. We do get a couple of warnings though. First, we're informed that ",(0,m.kt)("inlineCode",{parentName:"p"},"freefall")," must be set to False for the C-shock model. Then we get a few integrator warnings. These are not important and can be ignored as long as the element conservation looks ok. However, it is an indication that the integrator did struggle with these ODEs under these conditions."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'phase2_df=uclchem.analysis.read_output_file("../examples/test-output/cshock.dat")\nuclchem.analysis.check_element_conservation(phase2_df)\n')),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre"},"{'H': '0.007%', 'N': '0.042%', 'C': '0.151%', 'O': '0.039%'}\n")),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'species=["CO","H2O","CH3OH","#CO","#H2O","#CH3OH","@H2O","@CO","@CH3OH"]\n\nfig,[ax,ax2]=plt.subplots(1,2,figsize=(16,9))\nax=uclchem.analysis.plot_species(ax,phase2_df,species)\nsettings=ax.set(yscale="log",xlim=(1,20*dissipation_time),ylim=(1e-10,1e-2),\n            xlabel="Time / years", \n            ylabel="Fractional Abundance",xscale="log")\n\nax2.plot(phase2_df["Time"],phase2_df["Density"],color="black")\nax2.set(xscale="log")\nax3=ax2.twinx()\nax3.plot(phase2_df["Time"],phase2_df["gasTemp"],color="red")\nax2.set(xlabel="Time / year",ylabel="Density")\nax3.set(ylabel="Temperature",facecolor="red",xlim=(1,20*dissipation_time))\nax3.tick_params(axis=\'y\', colors=\'red\')\n')),(0,m.kt)("p",null,(0,m.kt)("img",{alt:"png",src:t(3882).Z,width:"1003",height:"544"})),(0,m.kt)("h3",{id:"j-shock"},"J-shock"),(0,m.kt)("p",null,"Running a j-shock is a simple case of changing function. We'll run a 10 km s ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mrow",{parentName:"msup"}),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"1")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"^{-1}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span"}),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"1")))))))))))))," shock through a gas of density ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("mn",{parentName:"mrow"},"1"),(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mn",{parentName:"msup"},"0"),(0,m.kt)("mn",{parentName:"msup"},"3"))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"10^3")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},"1"),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span",className:"mord"},"0"),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"3"))))))))))))," cm ",(0,m.kt)("span",{parentName:"p",className:"math math-inline"},(0,m.kt)("span",{parentName:"span",className:"katex"},(0,m.kt)("span",{parentName:"span",className:"katex-mathml"},(0,m.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.kt)("semantics",{parentName:"math"},(0,m.kt)("mrow",{parentName:"semantics"},(0,m.kt)("msup",{parentName:"mrow"},(0,m.kt)("mrow",{parentName:"msup"}),(0,m.kt)("mrow",{parentName:"msup"},(0,m.kt)("mo",{parentName:"mrow"},"\u2212"),(0,m.kt)("mn",{parentName:"mrow"},"3")))),(0,m.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"^{-3}")))),(0,m.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.kt)("span",{parentName:"span",className:"base"},(0,m.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141079999999999em",verticalAlign:"0em"}}),(0,m.kt)("span",{parentName:"span",className:"mord"},(0,m.kt)("span",{parentName:"span"}),(0,m.kt)("span",{parentName:"span",className:"msupsub"},(0,m.kt)("span",{parentName:"span",className:"vlist-t"},(0,m.kt)("span",{parentName:"span",className:"vlist-r"},(0,m.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141079999999999em"}},(0,m.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,m.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,m.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"\u2212"),(0,m.kt)("span",{parentName:"span",className:"mord mtight"},"3")))))))))))))," gas this time. Note that nothing stops us using the intial abundances we produced for the c-shock. UCLCHEM will not check that the initial density matches the density of the ",(0,m.kt)("inlineCode",{parentName:"p"},"abundLoadFile"),". It may not always be a good idea to do this but we should remember the intial abundances really are just a rough approximation."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'param_dict["initialDens"]=1e3\nparam_dict["freefall"]=False #lets remember to turn it off this time\nparam_dict["reltol"]=1e-12\n\nshock_vel=10.0\n\nif "abundSaveFile" in param_dict:\n    param_dict.pop("abundSaveFile")\nparam_dict["abundLoadFile"]="../examples/test-output/shockstart.dat"\nparam_dict["outputFile"]="../examples/test-output/jshock.dat"\n\n\nresult=uclchem.model.jshock(shock_vel=shock_vel,param_dict=param_dict)\n')),(0,m.kt)("p",null,"This time, we've turned off the freefall option and made reltol a little more stringent. The j-shock ends up running a bit slower but we get no warnings on this run."),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'phase2_df=uclchem.analysis.read_output_file(param_dict["outputFile"])\nuclchem.analysis.check_element_conservation(phase2_df)\n')),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre"},"{'H': '0.003%', 'N': '0.000%', 'C': '0.000%', 'O': '0.000%'}\n")),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre",className:"language-python"},'species=["CO","H2O","CH3OH","#CO","#H2O","#CH3OH","@H2O","@CO","@CH3OH"]\n\nfig,[ax,ax2]=plt.subplots(1,2,figsize=(16,9))\nax=uclchem.analysis.plot_species(ax,phase2_df,species)\nsettings=ax.set(yscale="log",xlim=(1e-7,1e6),ylim=(1e-10,1e-2),\n            xlabel="Time / years", \n            ylabel="Fractional Abundance",xscale="log")\n\nax2.plot(phase2_df["Time"],phase2_df["Density"],color="black")\nax2.set(xscale="log",yscale="log")\nax3=ax2.twinx()\nax3.plot(phase2_df["Time"],phase2_df["gasTemp"],color="red")\nax2.set(xlabel="Time / year",ylabel="Density")\nax3.set(ylabel="Temperature",facecolor="red",xlim=(1e-7,1e6))\nax3.tick_params(axis=\'y\', colors=\'red\')\n')),(0,m.kt)("p",null,(0,m.kt)("img",{alt:"png",src:t(966).Z,width:"1003",height:"544"})),(0,m.kt)("p",null,"That's everything! We've run various science models using reasonable starting abundances that we produced by running a simple UCLCHEM model beforehand. One benefit of this method is that the abundances are consistent with the network. If we start with arbitrary, perhaps observationally motivated, abundances, it would be possible to initiate the model in a state our network could never produce. "),(0,m.kt)("p",null,"However, one should be aware of the limitations of this method. A freefall collapse from low density to high is not really how a molecular cloud forms and so the abundances are only approximately similar to values they'd truly have in a real cloud. Testing whether your results are sensitive to things like the time you run the preliminary for or the exact density is a good way to make sure these approximations are not problematic."),(0,m.kt)("p",null,"Bear in mind that you can use ",(0,m.kt)("inlineCode",{parentName:"p"},"abundSaveFile")," and ",(0,m.kt)("inlineCode",{parentName:"p"},"abundLoadFile")," in the same model run. This lets you chain model runs together. For example, you could run a c-shock from a cloud model as we did here and then a j-shock with the c-shock's abundances as the initial abundances."))}N.isMDXComponent=!0},3882:(a,e,t)=>{t.d(e,{Z:()=>s});const s=t.p+"assets/images/modelling_objects_16_0-276d4b99ca4c501e7d43933df330cac2.png"},966:(a,e,t)=>{t.d(e,{Z:()=>s});const s=t.p+"assets/images/modelling_objects_21_0-d270fe54c17100ff5b4e2bf5f181e8ec.png"},3944:(a,e,t)=>{t.d(e,{Z:()=>s});const s=t.p+"assets/images/modelling_objects_8_0-8449cbc8d8153ece492a1ca7cec3c032.png"}}]);